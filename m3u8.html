<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=UTF-8" />
<meta http-equiv="content-language" content="zh-CN" />
<meta name="Viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
<title>p2p播放器</title>
<script src="https://cdn.jsdelivr.net/npm/p2p-media-loader-core@latest/build/p2p-media-loader-core.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/p2p-media-loader-hlsjs@latest/build/p2p-media-loader-hlsjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@0.12.4/dist/hls.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/dplayer@1.25.0/dist/DPlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/dplayer@1.25.0/dist/DPlayer.min.js"></script>
<style type="text/css">
    body,html{width:100%;height:100%;background:#000;padding:0;margin:0;overflow-x:hidden;overflow-y:hidden}
    *{margin:0;border:0;padding:0;text-decoration:none}
    #dplayer{width:100%;height:100%;}
</style>
</head>
<body>
    <div id="dplayer"></div>
    <script>
      function getQueryVariable(variable)
          {
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
        }
      var webdata = {
        set:function(key,val){
            window.sessionStorage.setItem(key,val);
        },
        get:function(key){
            return window.sessionStorage.getItem(key);
        },
        del:function(key){
            window.sessionStorage.removeItem(key);
        },
        clear:function(key){
            window.sessionStorage.clear();
        }
    };
    var url = getQueryVariable("url");
            window.dp = new DPlayer({
                container: document.getElementById("dplayer"),
                theme: '#FF0000',
                autoplay: false,
                preload: 'auto',
                video: {
                    url: url,
                    pic: 'https://tva1.sinaimg.cn/large/007GlUIVgy1g2aheh503rj30jq0d9q4t.jpg',
                    type: 'customHls',
                    customType: {
                        "customHls": function (video, player) {
                            const engine = new p2pml.hlsjs.Engine();
                            const hls = new Hls({
                                liveSyncDurationCount: 7, 
                                loader: engine.createLoaderClass()
                            });
                            p2pml.hlsjs.initHlsJsPlayer(hls);
                            hls.loadSource(video.src);
                            hls.attachMedia(video);
                        }
                    }
                }
            });
      dp.seek(webdata.get('vod'+url));
    setInterval(function(){
        webdata.set('vod'+url,dp.video.currentTime);
    },1000);
    </script>
</body>
</html>